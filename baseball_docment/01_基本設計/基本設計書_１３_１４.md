第13章 監視設計13.1. 監視項目非機能要件定義書 1 および安定運用のために、以下の項目を監視する。カテゴリ監視項目監視内容リソース監視CPU使用率Xserver VPS のCPU使用率 2メモリ使用率Xserver VPS のメモリ使用率 3ディスク使用率Xserver VPS のディスク空き容量 4可用性監視 (Uptime)サービス死活監視本番環境ドメイン (https://yourdomain.com) へのHTTP GETリクエストが200 OKを返すかパフォーマンス監視API応答時間主要APIエンドポイントの平均応答時間 5エラー監視5xxエラーレートNginx / Laravel で発生する 5xx系 (サーバーエラー) の発生率4xxエラーレート401, 403, 429 (認証/認可/レートリミット) エラーの発生率バッチ処理監視バッチ実行ステータスcron (schedule:run) および各バッチ (games:update-status 等) が正常に終了したか (終了コード 0)13.2. アラート閾値非機能要件定義書 6 に基づき、以下の閾値を設定し、超過した場合は運用担当者（管理者）に通知する。監視項目閾値 (アラート発報条件)優先度 (非機能要件)CPU使用率80% が 10分以上継続中メモリ使用率90% が 10分以上継続高ディスク使用率90% を超過高サービス死活監視2回連続で 200 OK 以外を検知 (例: 5xx, タイムアウト)高API応答時間95パーセンタイルの応答時間が 1000ms を超過 7高5xxエラーレート1分あたりの 5xx エラーが 1% を超過高バッチ実行ステータスバッチ処理が異常終了 (終了コード 0 以外)高13.3. 監視ツール (候補)Xserver VPSの標準機能および外部SaaSを組み合わせて監視を実現する。Xserver VPS 標準機能: CPU、メモリ、ディスク、トラフィックの基本的なリソース監視。Uptime Robot (外部SaaS): サービス死活監視（可用性 99.5% 8）。New Relic / Datadog (APMツール): API応答時間、エラーレート、DBクエリパフォーマンスの詳細な監視 9。Laravel Log (Slack連携): CRITICAL 以上のエラーログ、バッチ処理失敗をSlackに即時通知 10。詳細設計への共通コンテキスト（第13章）後続タスク（詳細設計）への指示:監視ツール選定と導入手順:「13.3. 監視ツール」の候補から、予算と要件（非機能要件 11）に基づき使用するツールを正式に選定してください。APMツール（New Relicなど）を導入する場合、Laravelへのエージェント導入手順と設定（.env へのライセンスキー設定など）を「16. デプロイ設計」または「運用手順書」に記載してください。アラート通知設定:Uptime Robot やAPMツールで、「13.2. アラート閾値」に基づいたアラートポリシーを具体的に設定する手順を「運用手順書」にまとめてください。Laravelのログ（config/logging.php）にSlackチャンネル設定を追加し、ERROR 以上のログがSlackに通知されるよう設定してください 12。ヘルスチェックAPIの実装:サービス死活監視のため、認証不要な /api/v1/health エンドポイントを実装し、DB接続（DB::connection()->getPdo()）の確認を行い、正常時にHTTP 200と { "status": "ok" } を返す処理を実装してください。第14章 バックアップ・リカバリ設計14.1. バックアップ対象システムの復旧に必要な以下のデータをバックアップ対象とする。データベース: MySQL (grass_baseball_matching スキーマ) の全データ。アプリケーションコード: /var/www/grass-baseball-matching 配下の Laravel プロジェクトソースコード（Gitリポジトリで管理されているため、スナップショットとしての優先度は低）。設定ファイル:Nginx設定ファイル (/etc/nginx/sites-available/)SSL証明書 (/path/to/ssl/)環境変数ファイル (/var/www/grass-baseball-matching/.env) ※最重要永続データ (ストレージ): （本システムではユーザーアップロードファイル等はないため、対象外）14.2. バックアップ頻度・世代管理非機能要件定義書 13 に基づき、以下の通り定義する。対象: データベース (MySQL)バックアップ頻度: 日次 (例: 毎日 AM 04:00) 14実行方法: Xserver VPS の標準バックアップ機能、または mysqldump を実行する cron スクリプト。保持期間 (世代管理): 30日間 1514.3. リストア手順概要 (DB)障害発生時（非機能要件 MTTR: 24時間以内 16）にデータベースを復旧するための手順概要。障害検知: 監視アラート（第13章）により障害を検知。影響範囲確認: 障害がDB起因であるか特定。サービス停止: 必要に応じて Nginx でメンテナンス画面に切り替え。リストアポイント決定: バックアップ（直近の深夜、または30日以内 17）から復旧ポイントを決定。リストア実行 (Xserver VPS機能の場合):a.  Xserver VPS のコントロールパネルにログイン。b.  「自動バックアップ」メニューから対象サーバーを選択。c.  リストアポイント（日付）を選択し、MySQLのリストアを実行。リストア実行 (mysqldumpの場合):a.  バックアップファイル（.sql.gz）をサーバーに配置。b.  gunzip < backup.sql.gz で展開。c.  mysql -u [user] -p [database] < backup.sql コマンドでデータをインポート。データ整合性確認:a.  管理画面にログインし、データ（ユーザー、試合）が正常に復旧しているか確認。サービス再開: メンテナンス画面を解除。詳細設計への共通コンテキスト（第14章）後続タスク（詳細設計）への指示:バックアップスクリプトの作成:Xserver VPS の標準機能を利用しない場合、「14.2. バックアップ頻度」に基づき、mysqldump を実行し、S3や別ストレージに転送するシェルスクリプト（backup.sh）を作成してください。このスクリプトを cron に登録する手順を「運用手順書」に記載してください。環境変数ファイルの管理:「14.1. バックアップ対象」で最重要とした .env ファイルは、Git管理から除外し、安全な場所（パスワードマネージャー、プライベートS3バケットなど）で別途厳重に管理する運用ルールを定めてください。リカバリ手順書の作成:「14.3. リストア手順概要」を基に、スクリーンショットや具体的なコマンドを含む詳細な「データベースリカバリ手順書」を作成し、「運用手順書」の一部としてください。MTTR（目標復旧時間）24時間以内 18 を達成可能か、手順のリハーサル（テスト環境でのリストア）計画を立ててください。第13章と第14章は以上となります。